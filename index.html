<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siapa Secret Admirer Kamu & Kejutan Spesial!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVXM5RdhCRK0B3TUmrQAATGHCVARg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f4f8; /* Warna latar belakang yang lembut */
            margin: 0;
            padding: 16px; /* Padding untuk mobile */
        }
        .container {
            background-color: white;
            padding: 24px; /* Padding lebih besar untuk kontainer */
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 400px; /* Lebar maksimal kontainer */
        }
        .btn {
            display: inline-block; /* Agar bisa diatur padding dan margin */
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 16px; /* Margin atas untuk tombol */
            width: 100%; /* Tombol memenuhi lebar */
        }
        .btn-primary {
            background-color: #3b82f6; /* Biru */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #6b7280; /* Abu-abu */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
        }
        .btn-accent { /* Tombol baru untuk langkah selanjutnya */
            background-color: #f59e0b; /* Kuning/Oranye */
            color: white;
        }
        .btn-accent:hover {
            background-color: #d97706;
            transform: translateY(-2px);
        }
        .btn-share {
            background-color: #10b981; /* Hijau */
            color: white;
        }
        .btn-share:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        .gender-btn {
            border: 2px solid #d1d5db; /* Abu-abu muda */
            color: #374151; /* Abu-abu tua */
            width: 100%; /* Tombol gender memenuhi lebar */
            margin-bottom: 12px; /* Jarak antar tombol gender */
        }
        .gender-btn.selected {
            background-color: #3b82f6; /* Biru */
            color: white;
            border-color: #3b82f6;
        }
        .gender-btn:hover:not(.selected) {
            background-color: #f3f4f6; /* Abu-abu sangat muda */
        }
        h1 {
            font-size: 1.75rem; /* Ukuran font lebih besar untuk judul */
            font-weight: 700;
            margin-bottom: 16px;
            color: #1f2937; /* Abu-abu gelap */
        }
        p {
            color: #4b5563; /* Abu-abu sedang */
            margin-bottom: 24px;
        }
        .hidden {
            display: none;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3b82f6; /* Biru */
            animation: spin 1s ease infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result-name {
            font-size: 2.5rem; /* Ukuran font sangat besar untuk nama */
            font-weight: 700;
            color: #ef4444; /* Merah */
            margin: 16px 0;
            animation: popIn 0.5s ease-out;
        }
        .title-text { /* Styling untuk gelar SUPER KING */
            font-size: 2.2rem;
            font-weight: 700;
            color: #8b5cf6; /* Ungu */
            margin: 16px 0;
            animation: popIn 0.5s ease-out 0.2s; /* Sedikit delay */
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .icon {
            font-size: 3rem; /* Ukuran ikon besar */
            margin-bottom: 16px;
        }
        #copyNotification { /* Digunakan juga untuk notifikasi screenshot */
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937; /* Abu-abu gelap */
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, bottom 0.3s ease-in-out;
        }
        #copyNotification.show {
            opacity: 1;
            bottom: 40px; /* Naikkan sedikit saat muncul */
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="genderSelectionScreen">
            <h1>Pilih Gender Kamu</h1>
            <p>Untuk melanjutkan, pilih gendermu di bawah ini.</p>
            <button id="maleButton" class="btn gender-btn" onclick="selectGender('male')">Pria ðŸ§”</button>
            <button id="femaleButton" class="btn gender-btn" onclick="selectGender('female')">Wanita ðŸ‘©</button>
            <button id="continueButton" class="btn btn-primary" onclick="showCalculating()" disabled>Lanjut</button>
        </div>

        <div id="calculatingScreen" class="hidden">
            <h1>Menganalisis...</h1>
            <p>Harap tunggu, sistem kami sedang menghitung berdasarkan pilihanmu.</p>
            <div class="spinner"></div>
        </div>

        <div id="prankScreen" class="hidden">
            <div class="icon">ðŸŽ‰</div>
            <h1>Selamat!</h1>
            <p>Setelah melalui perhitungan algoritma super canggih dan analisis mendalam...</p>
            <p>Pengagum rahasiamu adalah...</p>
            <div class="result-name">VEDA!</div>
            <p>ðŸ’–</p>
            <button class="btn btn-accent" onclick="showSuperKingScreen()">Lanjut ke Kejutan Berikutnya!</button>
        </div>

        <div id="superKingScreen" class="hidden">
            <div class="icon">ðŸ‘‘</div>
            <h1>PENGUMUMAN SPESIAL!</h1>
            <p>Atas keberhasilanmu mengungkap pengagum rahasia...</p>
            <p>Kamu dianugerahi gelar kehormatan:</p>
            <div class="title-text">SUPER KING</div>
            <p>oleh King Veda!</p>
            <button id="shareTitleButton" class="btn btn-share" onclick="shareTitleAsImage()">Bagikan Gelar Ini!</button>
            <button class="btn btn-secondary" onclick="tryAgain()">Coba Lagi dari Awal?</button>
        </div>


        <div id="copyNotification" class="hidden">Link berhasil disalin!</div>
    </div>

    <input type="text" id="shareLinkInput" style="position: absolute; left: -9999px; top: -9999px;">

    <script>
        const genderSelectionScreen = document.getElementById('genderSelectionScreen');
        const calculatingScreen = document.getElementById('calculatingScreen');
        const prankScreen = document.getElementById('prankScreen');
        const superKingScreen = document.getElementById('superKingScreen');
        const continueButton = document.getElementById('continueButton');
        const maleButton = document.getElementById('maleButton');
        const femaleButton = document.getElementById('femaleButton');
        const copyNotification = document.getElementById('copyNotification');
        const shareLinkInput = document.getElementById('shareLinkInput'); // Tetap ada jika diperlukan di masa depan
        const shareTitleButton = document.getElementById('shareTitleButton');

        let selectedGender = null;

        function selectGender(gender) {
            selectedGender = gender;
            if (gender === 'male') {
                maleButton.classList.add('selected');
                femaleButton.classList.remove('selected');
            } else {
                femaleButton.classList.add('selected');
                maleButton.classList.remove('selected');
            }
            continueButton.disabled = false;
        }

        function showCalculating() {
            if (!selectedGender) {
                console.error('Pilihan gender tidak ada saat showCalculating dipanggil.');
                showGeneralNotification("Pilih gender dulu ya!", true); // Notifikasi error
                return;
            }
            genderSelectionScreen.classList.add('hidden');
            calculatingScreen.classList.remove('hidden');

            setTimeout(() => {
                calculatingScreen.classList.add('hidden');
                prankScreen.classList.remove('hidden');
            }, 2000);
        }

        function showSuperKingScreen() {
            prankScreen.classList.add('hidden');
            superKingScreen.classList.remove('hidden');
        }

        function tryAgain() {
            prankScreen.classList.add('hidden');
            superKingScreen.classList.add('hidden');
            genderSelectionScreen.classList.remove('hidden');
            
            selectedGender = null;
            maleButton.classList.remove('selected');
            femaleButton.classList.remove('selected');
            continueButton.disabled = true;
            shareTitleButton.disabled = false; // Aktifkan kembali tombol share jika di-disable saat proses
            shareTitleButton.textContent = "Bagikan Gelar Ini!";
        }

        // Fungsi notifikasi yang lebih umum
        function showGeneralNotification(message, isError = false) {
            copyNotification.textContent = message;
            if (isError) {
                copyNotification.style.backgroundColor = '#ef4444'; // Merah untuk error
            } else {
                copyNotification.style.backgroundColor = '#1f2937'; // Default
            }
            copyNotification.classList.add('show');
            setTimeout(() => {
                copyNotification.classList.remove('show');
                 // Reset background color after hiding
                setTimeout(() => { copyNotification.style.backgroundColor = '#1f2937'; }, 500);
            }, 3000); // Tampilkan notifikasi lebih lama
        }
        
        async function shareTitleAsImage() {
            shareTitleButton.disabled = true;
            shareTitleButton.textContent = "Memproses Screenshot...";

            try {
                const elementToCapture = document.getElementById('superKingScreen');
                if (!elementToCapture) {
                    showGeneralNotification("Elemen untuk screenshot tidak ditemukan.", true);
                    resetShareButton();
                    return;
                }

                // Sembunyikan sementara tombol agar tidak masuk screenshot
                const buttonsToHide = elementToCapture.querySelectorAll('button');
                buttonsToHide.forEach(btn => btn.style.visibility = 'hidden');

                const canvas = await html2canvas(elementToCapture, {
                    scale: window.devicePixelRatio * 1.5, // Tingkatkan skala untuk kualitas lebih baik
                    useCORS: true, // Untuk font eksternal jika ada
                    logging: false, // Set true untuk debug html2canvas
                     // Abaikan elemen notifikasi jika terlihat
                    ignoreElements: (element) => element.id === 'copyNotification'
                });

                // Kembalikan visibilitas tombol
                buttonsToHide.forEach(btn => btn.style.visibility = 'visible');
                
                const dataUrl = canvas.toDataURL('image/png');

                // Konversi Data URL ke Blob lalu ke File
                const blob = await fetch(dataUrl).then(res => res.blob());
                const imageFile = new File([blob], "gelar-super-king.png", { type: "image/png" });

                if (navigator.canShare && navigator.canShare({ files: [imageFile] })) {
                    await navigator.share({
                        files: [imageFile],
                        title: 'Gelar Super King!',
                        text: 'Wow! Aku dapat gelar SUPER KING dari King Veda! ðŸ¥³',
                    });
                    showGeneralNotification('Berhasil dibagikan!');
                    resetShareButton();
                } else {
                    // Fallback jika Web Share API tidak didukung untuk file
                    fallbackShare(dataUrl);
                }
            } catch (error) {
                console.error('Error saat mengambil atau membagikan screenshot:', error);
                showGeneralNotification('Gagal membuat atau membagikan screenshot.', true);
                // Kembalikan visibilitas tombol jika error terjadi di tengah proses
                const elementToCapture = document.getElementById('superKingScreen');
                if (elementToCapture) {
                    const buttonsToHide = elementToCapture.querySelectorAll('button');
                    buttonsToHide.forEach(btn => btn.style.visibility = 'visible');
                }
                resetShareButton();
            }
        }

        function fallbackShare(dataUrl) {
            // 1. Trigger download gambar
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'gelar-super-king.png';
            document.body.appendChild(link); // Diperlukan untuk Firefox
            link.click();
            document.body.removeChild(link); // Bersihkan setelah diklik

            // 2. Buka WhatsApp dengan pesan
            const waMessage = encodeURIComponent(`Aku baru saja dapat gelar SUPER KING dari King Veda! ðŸ‘‘ Aku kirim screenshotnya ya. Penasaran? Coba juga prank ini: ${window.location.href}`);
            window.open(`https://api.whatsapp.com/send?text=${waMessage}`, '_blank');

            // 3. Notifikasi ke pengguna
            showGeneralNotification("Screenshot diunduh. Buka WhatsApp & lampirkan gambarnya!");
            resetShareButton();
        }

        function resetShareButton() {
            shareTitleButton.disabled = false;
            shareTitleButton.textContent = "Bagikan Gelar Ini!";
        }


        // Inisialisasi
        continueButton.disabled = true;

    </script>
</body>
</html>
