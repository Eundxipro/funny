<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Judul halaman bisa diubah sesuai topiknya -->
    <title>Kisah Romansa Kampus - Kisah Kampus Kita</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- CSS di-copy dari file asli -->
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f0f2f5; color: #1c1e21; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; margin: 0; scroll-behavior: smooth; }
        .container { background-color: #ffffff; padding: 32px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); width: 100%; max-width: 800px; text-align: center; }
        h2 { font-size: 2rem; font-weight: 600; margin-bottom: 12px; color: #3b82f6; text-align: left; }
        h3 { font-size: 1.5rem; font-weight: 600; color: #1f2937; margin-top: 40px; margin-bottom: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; }
        h4 { font-size: 1.25rem; font-weight: 600; color: #1f2937; margin-top: 20px; margin-bottom: 15px; text-align: left; }
        .btn-secondary { background-color: #6b7280; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 500; cursor: pointer; transition: background-color 0.3s, transform 0.2s; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 24px; border: none; text-decoration: none; }
        .btn-secondary:hover { background-color: #4b5563; transform: translateY(-2px); }
        .content-image { max-width: 100%; height: auto; border-radius: 12px; margin-top: 12px; margin-bottom: 12px; display: block; margin-left: auto; margin-right: auto; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .content-text { text-align: left; line-height: 1.8; color: #374151; font-size: 1rem; }
        .content-text p, .content-text ul { margin-bottom: 1.25rem; }
        .content-text ul:not(.sub-topic-shortcut-list) { list-style-type: none; padding-left: 0; }
        .content-text li:not(.shortcut-item) { margin-bottom: 0.75rem; padding-left: 1.75em; position: relative; }
        .content-text li:not(.shortcut-item)::before { content: "\f058"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; left: 0; color: #3b82f6; font-size: 1em; }
        .sub-topic-shortcuts { margin-top: 0px; margin-bottom: 30px; padding: 15px; background-color: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; text-align: left; }
        .sub-topic-shortcuts h4 { font-size: 1.1rem; font-weight: 600; color: #3b82f6; margin-top:0; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #dbeafe; }
        .sub-topic-shortcut-list { list-style: none; padding-left: 0; }
        .sub-topic-shortcut-list .shortcut-item { margin-bottom: 8px; padding-left: 0; }
        .sub-topic-shortcut-list .shortcut-item::before { display: none; }
        .sub-topic-shortcut-list .shortcut-item a { text-decoration: none; color: #1f2937; display: block; padding: 10px 12px; border-radius: 6px; transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease; font-size: 0.95rem; }
        .sub-topic-shortcut-list .shortcut-item a:hover { background-color: #e0e7ff; color: #3b82f6; transform: translateX(3px); }
        .sub-topic-shortcut-list .shortcut-item a strong { color: #3b82f6; font-weight: 600; }
        .sub-topic-shortcut-list .shortcut-item .shortcut-subtitle { font-size: 0.8rem; color: #6b7280; display: block; margin-top: 2px; }
        .sub-topic-comment-section { margin-top: 25px; padding-top: 15px; border-top: 1px solid #e0e7ff; text-align: left; }
        .comment-list { max-height: 300px; overflow-y: auto; margin-bottom: 15px; padding-right: 10px; }
        .comment-item { background-color: #f9fafb; padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; border: 1px solid #e5e7eb; }
        .comment-author { font-weight: 600; color: #3b82f6; margin-bottom: 3px; font-size: 0.85rem; }
        .comment-text { font-size: 0.9rem; color: #374151; line-height: 1.5; word-wrap: break-word; }
        .comment-timestamp { font-size: 0.7rem; color: #9ca3af; margin-top: 5px; text-align: right; }
        .comment-form textarea { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #d1d5db; min-height: 60px; margin-bottom: 8px; font-size: 0.9rem; resize: vertical; }
        .comment-form button { background-color: #3b82f6; color: white; padding: 8px 16px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: background-color 0.3s; border: none; font-size: 0.9rem; }
        .comment-form button:hover { background-color: #2563eb; }
        .comment-form button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .no-comments { color: #6b7280; text-align: center; padding: 15px; font-size: 0.9rem; }
        .screen { animation: fadeIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container screen">
        <!-- Tombol kembali sekarang adalah link biasa -->
        <a href="index.html" id="backToTopicsButton" class="btn-secondary"><i class="fas fa-chevron-left"></i> Kembali ke Topik</a>

        <!-- Judul Utama Konten -->
        <h2><i class="fas fa-heartbeat" style="margin-right: 10px; color: #3b82f6;"></i>Kisah Romansa di Kebun Percobaan</h2>
        
        <!-- ======================================================= -->
        <!-- == MULAI PASTE KONTEN HTML ANDA DARI SINI == -->
        <!-- ======================================================= -->
        <div id="contentBody" class="content-text">
            <div class="sub-topic-shortcuts"><h4><i class="fas fa-stream" style="margin-right: 8px;"></i>Pintasan Kisah:</h4><ul class="sub-topic-shortcut-list"><li class="shortcut-item"><a href="#romansa-kisah-1"><strong>Kisah #1:</strong> <span class="shortcut-subtitle">Pertemuan di Praktikum Jagung</span></a></li><li class="shortcut-item"><a href="#romansa-kisah-2"><strong>Kisah #2:</strong> <span class="shortcut-subtitle">Momen Lain di Kebun?</span></a></li></ul></div><div id="romansa-kisah-1"><h3>Kisah #1: Pertemuan di Praktikum Jagung</h3><img src="https://raw.githubusercontent.com/Eundxipro/funny/main/WhatsApp%20Image%202025-05-31%20at%2019.46.45.jpeg" alt="Pertemuan di kebun percobaan Fakultas Pertanian" class="content-image"><p>Di tengah hijaunya kebun percobaan Fakultas Pertanian, di antara aroma tanah basah dan semangat praktikum jagung, sebuah pertemuan tak terduga terjadi. Dua pasang mata bertemu, mungkin awalnya hanya sebatas rekan praktikum, namun siapa sangka momen sederhana itu terekam dalam jejak digital ini? Apakah ini awal dari sebuah kisah romansa yang akan mekar seiring tumbuhnya sang jagung? Hanya waktu yang bisa menjawab...</p>
            
            <!-- Bagian Komentar untuk sub-topik ini -->
            <div class="sub-topic-comment-section" id="comment-section-romansa-kisah-1">
                <h4><i class="fas fa-comments" style="margin-right: 8px;"></i>Reaksi & Komentar Anonim</h4>
                <div id="comment-list-romansa-kisah-1" class="comment-list"></div>
                <p class="no-comments" id="no-comments-romansa-kisah-1" style="display: block;">Memuat komentar...</p> 
                <form class="comment-form" data-subtopicid="romansa-kisah-1">
                    <textarea placeholder="Tulis komentarmu sebagai pengunjung anonim..." required></textarea>
                    <button type="submit">Kirim Komentar</button>
                </form>
            </div>

            </div><div id="romansa-kisah-2"><h3>Kisah #2: Momen Lain di Kebun?</h3><img src="https://raw.githubusercontent.com/Eundxipro/funny/main/WhatsApp%20Image%202025-05-31%20at%2020.52.34.jpeg" alt="Kisah Romansa Kampus #2" class="content-image"><p>Satu lagi potret dari kebun percobaan yang menyimpan cerita. Apakah ini kelanjutan dari kisah pertama, atau sebuah babak baru dengan tokoh yang berbeda? Senyum yang terukir dan suasana akrab yang terpancar seolah memberi isyarat bahwa benih-benih kedekatan mungkin telah tersemai. Kebun percobaan tak hanya menjadi saksi pertumbuhan tanaman, tapi juga tumbuhnya perasaan.</p>
            
            <!-- Bagian Komentar untuk sub-topik ini -->
            <div class="sub-topic-comment-section" id="comment-section-romansa-kisah-2">
                <h4><i class="fas fa-comments" style="margin-right: 8px;"></i>Reaksi & Komentar Anonim</h4>
                <div id="comment-list-romansa-kisah-2" class="comment-list"></div>
                <p class="no-comments" id="no-comments-romansa-kisah-2" style="display: block;">Memuat komentar...</p> 
                <form class="comment-form" data-subtopicid="romansa-kisah-2">
                    <textarea placeholder="Tulis komentarmu sebagai pengunjung anonim..." required></textarea>
                    <button type="submit">Kirim Komentar</button>
                </form>
            </div>
            </div>
        </div>
        <!-- ======================================================= -->
        <!-- == AKHIR DARI BAGIAN PASTE KONTEN HTML == -->
        <!-- ======================================================= -->

    </div>

    <script type="module">
        // Import fungsi yang dibutuhkan dari Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // KONFIGURASI FIREBASE ANDA (Harus ada di setiap halaman dengan komentar)
        const firebaseConfig = {
         apiKey: "AIzaSyA_lcZ-_2eDPcZ44efVhRRcOkJQamO4S5E",
         authDomain: "funny-e436a.firebaseapp.com",
         projectId: "funny-e436a",
         storageBucket: "funny-e436a.firebasestorage.app",
         messagingSenderId: "626813764903",
         appId: "1:626813764903:web:73250f741ddaac3a555502",
         measurementId: "G-MSSK2DD3SD"
        };
        
        let app, db, auth;
        let activeCommentListeners = {};
        const appId = (firebaseConfig && firebaseConfig.appId) ? firebaseConfig.appId : 'default-app-id-error-config';

        // Fungsi-fungsi yang sama dari file asli Anda
        function generateAnonymousName() {
            const adjectives = ["Ceria", "Misterius", "Bijak", "Kreatif", "Semangat", "Unik", "Harmonis", "Optimis"];
            const nouns = ["Pengunjung", "Penjelajah", "Pengamat", "Pencari Ilmu", "Sahabat Kampus", "Kontributor"];
            const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
            const randomNumber = Math.floor(Math.random() * 1000);
            return `${randomNoun} ${randomAdjective} #${randomNumber}`;
        }

        async function submitCommentForSubTopic(event, subTopicId) {
            event.preventDefault();
            if (!subTopicId || !db || !auth || !auth.currentUser) { return; }
            const form = event.target;
            const textarea = form.querySelector('textarea');
            const button = form.querySelector('button');
            const text = textarea.value.trim();
            if (!text) return;

            button.disabled = true;
            button.textContent = "Mengirim...";

            try {
                const commentsCollectionPath = `/artifacts/${appId}/public/data/subtopic_comments/${subTopicId}/comments`;
                await addDoc(collection(db, commentsCollectionPath), {
                    text: text,
                    authorName: generateAnonymousName(),
                    createdAt: serverTimestamp(),
                    userId: auth.currentUser.uid
                });
                textarea.value = '';
            } catch (error) {
                console.error(`Error adding comment for ${subTopicId}: `, error);
            } finally {
                button.disabled = false;
                button.textContent = "Kirim Komentar";
            }
        }

        function displayCommentInList(data, listElement) {
            const commentItem = document.createElement('div');
            commentItem.classList.add('comment-item');
            const authorP = document.createElement('p');
            authorP.classList.add('comment-author');
            authorP.textContent = data.authorName || "Pengunjung Anonim";
            const textP = document.createElement('p');
            textP.classList.add('comment-text');
            textP.textContent = data.text;
            commentItem.appendChild(authorP);
            commentItem.appendChild(textP);
            if (data.createdAt && data.createdAt.toDate) {
                const timestampP = document.createElement('p');
                timestampP.classList.add('comment-timestamp');
                timestampP.textContent = data.createdAt.toDate().toLocaleString('id-ID', { dateStyle: 'medium', timeStyle: 'short'});
                commentItem.appendChild(timestampP);
            }
            listElement.appendChild(commentItem);
        }

        function loadCommentsForSubTopic(subTopicId) {
            const commentListEl = document.getElementById(`comment-list-${subTopicId}`);
            const noCommentsEl = document.getElementById(`no-comments-${subTopicId}`);
            if (!commentListEl || !noCommentsEl) return;
            
            if (activeCommentListeners[subTopicId]) activeCommentListeners[subTopicId]();
            commentListEl.innerHTML = '';
            noCommentsEl.textContent = "Memuat komentar...";
            noCommentsEl.style.display = 'block';

            const commentsCollectionPath = `/artifacts/${appId}/public/data/subtopic_comments/${subTopicId}/comments`;
            const q = query(collection(db, commentsCollectionPath), orderBy("createdAt", "desc"));

            activeCommentListeners[subTopicId] = onSnapshot(q, (querySnapshot) => {
                commentListEl.innerHTML = ''; 
                if (querySnapshot.empty) {
                    noCommentsEl.textContent = "Belum ada komentar. Jadilah yang pertama!";
                    noCommentsEl.style.display = 'block'; 
                } else {
                    noCommentsEl.style.display = 'none'; 
                    querySnapshot.forEach((doc) => { displayCommentInList(doc.data(), commentListEl); });
                }
            }, (error) => {
                console.error(`Error loading comments:`, error);
                noCommentsEl.textContent = "Gagal memuat komentar.";
                noCommentsEl.style.display = 'block';
            });
        }

        // Fungsi utama yang dijalankan saat halaman dimuat
        async function initializePage() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setLogLevel('error');
                await signInAnonymously(auth);
                console.log("Firebase initialized and user signed in for this page.");

                // Setelah Firebase siap, cari semua form komentar di halaman ini dan aktifkan
                document.querySelectorAll('.comment-form').forEach(form => {
                    const subTopicId = form.dataset.subtopicid;
                    if(subTopicId) {
                        loadCommentsForSubTopic(subTopicId);
                        form.addEventListener('submit', (event) => submitCommentForSubTopic(event, subTopicId));
                    }
                });

            } catch(e) {
                console.error("Critical Firebase Error on this page:", e);
                // Nonaktifkan semua form komentar jika Firebase gagal
                document.querySelectorAll('.comment-form').forEach(form => form.style.display = 'none');
                document.querySelectorAll('.no-comments').forEach(el => el.textContent = 'Fitur komentar gagal dimuat.');
            }
        }
        
        // Jalankan fungsi utama saat dokumen (HTML) selesai dimuat
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
